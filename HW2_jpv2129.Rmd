---
title: "Homework 2"
author: "Jake Vettoretti"
date: "2025-09-26"
output: github_document
---

```{r}
library(tidyverse) #installing necessary libraries
library(readr)
library(readxl)
```

## Problem 1

Installing and cleaning pols data.

```{r}
pols_df = read_csv("data/pols-month.csv") |> #Clean pols.csv data
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(
    month = month.name[as.numeric(month)],
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem",
      TRUE ~ NA_character_
    )
  ) |> 
  select(-prez_dem, -prez_gop, -day) |> 
  arrange(year, month)

pols_df
```

Installing and cleaning snp data.

```{r}
snp_df = read_csv("data/snp.csv") |>  # Clean snp.csv data
  janitor::clean_names() |>
  mutate(
    date = as.Date(date, format = "%m/%d/%y"),
    year = as.integer(ifelse(
      format(date, "%y") <= "68", 
      paste0("20", format(date, "%y")),
      paste0("19", format(date, "%y"))
    )),
    month = month.name[as.integer(format(date, "%m"))]
  ) |>
  select(year, month, close) |>
  arrange(year, month)

snp_df
```

Preparing datasets for merge.

```{r}
unemployment_df = read_csv("data/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = jan:dec,
    names_to = "month_abbr",
    values_to = "unemployment_rate"
  ) |> 
  # Convert abbreviations using month.name and month.abb constants
  mutate(month = month.name[match(month_abbr, tolower(month.abb))]) |> 
  select(-month_abbr) |> 
  rename(year = year) |> 
  arrange(year, month)
```

Merging the data sets

```{r}
merged_data = pols_df |> #merging pols and snp to prepare for merge into unemployment
  left_join(snp_df, by = c("year", "month"))

final_data = merged_data |>  # Step 2: Merge unemployment into the result  
  left_join(unemployment_df, by = c("year", "month"))

final_data
```

Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables):

## Problem 2

Importing and cleaning the Mr. Trash Wheel Data

```{r}
# Mr. Trash Wheel
mr_trash_wheel = read_excel("data/trashwheeldata.xlsx", 
  sheet = "Mr. Trash Wheel", skip = 1, na = c("NA", ".", "")) %>%  # Skip the first row (metadata/header),
  janitor:: clean_names() |>  # Clean column names and remove rows that don't have dumpster data (NA in dumpster column)
  filter(!is.na(dumpster))|>
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  select(dumpster:homes_powered)   # Select only the relevant columns with dumpster-specific data
mr_trash_wheel

# Professor Trash Wheel - same process with consistent data types
professor_trash_wheel = read_excel("data/trashwheeldata.xlsx", 
  sheet = "Professor Trash Wheel", skip = 1, na = c("NA", ".", "")) %>%  
  janitor::clean_names() |>  
  filter(!is.na(dumpster))|>
  # Ensure consistent data types
  mutate(
    year = as.character(year)  # Convert to character to match Mr. Trash Wheel
  ) |>
  select(dumpster:homes_powered)

# Gwynnda Trash Wheel - same process with consistent data types
gwynnda_trash_wheel = read_excel("data/trashwheeldata.xlsx", 
  sheet = "Gwynnda Trash Wheel", skip = 1, na = c("NA", ".", "")) %>%  
  janitor::clean_names() |>  
  filter(!is.na(dumpster))|>
  # Ensure consistent data types
  mutate(
    year = as.character(year)  # Convert to character to match Mr. Trash Wheel
  ) |>
  select(dumpster:homes_powered)

# Add identifier variable to each dataset
mr_trash_wheel = mr_trash_wheel |> 
  mutate(trash_wheel = "Mr. Trash Wheel")

professor_trash_wheel = professor_trash_wheel |> 
  mutate(trash_wheel = "Professor Trash Wheel")

gwynnda_trash_wheel = gwynnda_trash_wheel |> 
  mutate(trash_wheel = "Gwynnda Trash Wheel")

# Combine all three into one tidy dataset
all_trash_wheels = bind_rows(mr_trash_wheel, professor_trash_wheel, gwynnda_trash_wheel) |> 
  select(trash_wheel, everything())  # Move identifier to first column

# View the combined tidy dataset
all_trash_wheels
```
